# üõ°Ô∏è ChimeraScan API - Documenta√ß√£o Completa

## üìã **Vis√£o Geral**

A **ChimeraScan API** √© um sistema completo de an√°lise de riscos e detec√ß√£o de fraudes para transa√ß√µes blockchain, especificamente focado em ativos tokenizados na rede Ethereum. O sistema oferece an√°lise em tempo real, gera√ß√£o de alertas autom√°ticos e um dashboard web interativo.

### üèóÔ∏è **Arquitetura do Sistema**

```mermaid
graph TB
    A[Client/Monitor] --> B[API REST]
    B --> C[Fraud Detector]
    C --> D[Rule Engine]
    C --> E[Risk Scorer]
    C --> F[Alert Manager]
    G[Dashboard] --> B
    H[Blockchain Monitor] --> B
    I[Database] --> C
```

### üöÄ **Funcionalidades Principais**

- ‚úÖ **An√°lise de Transa√ß√µes**: Detec√ß√£o de padr√µes fraudulentos
- ‚úÖ **Sistema de Regras**: Configura√ß√£o flex√≠vel de regras de detec√ß√£o
- ‚úÖ **Scoring de Risco**: Pontua√ß√£o de 0.0 a 1.0 baseada em m√∫ltiplos fatores
- ‚úÖ **Alertas Autom√°ticos**: Notifica√ß√µes por severidade (LOW/MEDIUM/HIGH/CRITICAL)
- ‚úÖ **Dashboard em Tempo Real**: Interface web com m√©tricas atualizadas
- ‚úÖ **Monitoramento Blockchain**: Integra√ß√£o com Ethereum mainnet
- ‚úÖ **Convers√£o ETH/USD**: Pre√ßos em tempo real via CoinGecko API

---

## üåê **Base URL e Informa√ß√µes Gerais**

### **URL Base**
```
http://localhost:5000
```

### **Versionamento**
- **Vers√£o Atual**: v1.0.0
- **API Path**: `/api/v1/`

### **Content-Type**
```
Content-Type: application/json
```

### **Autentica√ß√£o**
- **Tipo**: Nenhuma (desenvolvimento)
- **Produ√ß√£o**: JWT/Bearer Token (futuro)

---

## üìä **Dashboard Web**

### **P√°gina Principal**
```http
GET /
```

**Descri√ß√£o**: Interface web completa com m√©tricas em tempo real

**Funcionalidades**:
- üìà M√©tricas de sistema (uptime, transa√ß√µes, alertas)
- üìä Gr√°ficos interativos (Plotly.js)
- üîÑ Atualiza√ß√µes autom√°ticas a cada 3 segundos
- üö® Lista de alertas recentes
- ‚öôÔ∏è Status de regras ativas

**Resposta**: HTML page

---

## üè• **Health Check**

### **Verificar Status do Sistema**
```http
GET /health
```

**Descri√ß√£o**: Verifica se todos os componentes est√£o funcionando

**Resposta de Sucesso** (200):
```json
{
  "status": "healthy",
  "timestamp": "2025-08-22T13:15:30.123456",
  "version": "1.0.0",
  "components": {
    "fraud_detector": "operational",
    "blockchain_monitor": "operational", 
    "alert_manager": "operational"
  },
  "monitoring_active": false,
  "uptime_seconds": 3600.5,
  "errors": []
}
```

**Estados Poss√≠veis**:
- `healthy`: Todos os componentes operacionais
- `initializing`: Sistema iniciando
- `degraded`: Alguns componentes com problemas

---

## üîç **An√°lise de Transa√ß√µes**

### **Analisar Transa√ß√£o Individual**
```http
POST /api/v1/analyze/transaction
```

**Descri√ß√£o**: Analisa uma transa√ß√£o espec√≠fica em busca de padr√µes fraudulentos

**Campos Obrigat√≥rios**:
```json
{
  "hash": "string",
  "from_address": "string", 
  "value": "number",
  "gas_price": "number",
  "timestamp": "string (ISO 8601)",
  "block_number": "integer"
}
```

**Campos Opcionais**:
```json
{
  "to_address": "string",
  "transaction_type": "TRANSFER|SWAP|MINT|BURN|APPROVAL|CONTRACT_INTERACTION",
  "token_address": "string",
  "token_amount": "number",
  "fundeddate_from": "string (ISO 8601)",
  "fundeddate_to": "string (ISO 8601)"
}
```

**Campos para An√°lise de Carteira Nova**:
- `fundeddate_from`: Data de in√≠cio do funding da carteira (opcional)
- `fundeddate_to`: Data final do funding da carteira (opcional)
- Estes campos s√£o usados pela regra `new_wallet_interaction` para determinar a idade real da carteira

**Exemplo de Requisi√ß√£o**:
```json
{
  "hash": "0x1234567890abcdef1234567890abcdef12345678",
  "from_address": "0x742d35Cc631C0532925a3b8D33C9",
  "to_address": "0xF977814e90dA44bFA03b6295", 
  "value": 477890.47,
  "gas_price": 25.0,
  "timestamp": "2025-08-22T13:15:30Z",
  "block_number": 23197704,
  "transaction_type": "TRANSFER"
}
```

**Exemplo com An√°lise de Carteira Nova**:
```json
{
  "hash": "0x1234567890abcdef1234567890abcdef12345678",
  "from_address": "0x742d35Cc631C0532925a3b8D33C9",
  "to_address": "0xF977814e90dA44bFA03b6295", 
  "value": 5000.0,
  "gas_price": 25.0,
  "timestamp": "2025-08-22T13:15:30Z",
  "block_number": 23197704,
  "transaction_type": "TRANSFER",
  "fundeddate_from": "2025-08-22T01:00:00Z",
  "fundeddate_to": "2025-08-22T02:00:00Z"
}
```

**Resposta de Sucesso** (200):
```json
{
  "transaction_hash": "0x1234567890abcdef1234567890abcdef12345678",
  "analysis_result": {
    "is_suspicious": true,
    "risk_score": 0.751,
    "risk_level": "HIGH",
    "triggered_rules": ["high_value_transfer", "suspicious_gas_price"],
    "alert_count": 2
  },
  "alerts": [
    {
      "rule_name": "high_value_transfer",
      "severity": "HIGH",
      "title": "High Value Transfer",
      "description": "Transfer of $477,890.47 exceeds threshold of $10,000.00",
      "risk_score": 0.751,
      "detected_at": "2025-08-22T13:15:30.456789"
    }
  ],
  "context": {
    "analysis_duration_ms": 45.2,
    "rules_evaluated": 8,
    "wallet_age_hours": 168.0,
    "gas_price_ratio": 1.25,
    "transaction_type": "TRANSFER"
  },
  "analyzed_at": "2025-08-22T13:15:30.456789"
}
```

**C√≥digos de Erro**:
- `400`: Dados inv√°lidos ou campos obrigat√≥rios ausentes
- `500`: Erro interno do servidor
- `503`: Sistema n√£o inicializado

---

## üìä **M√©tricas e Estat√≠sticas**

### **M√©tricas em Tempo Real**
```http
GET /api/v1/metrics/realtime
```

**Descri√ß√£o**: Retorna m√©tricas atualizadas para o dashboard

**Resposta de Sucesso** (200):
```json
{
  "system": {
    "status": "healthy",
    "uptime_hours": 24.5,
    "start_time": "2025-08-21T12:30:00Z"
  },
  "transactions": {
    "total_analyzed": 1547,
    "suspicious_detected": 23,
    "detection_rate": 1.49,
    "last_24h": 892
  },
  "alerts": {
    "total_generated": 45,
    "by_severity": {
      "LOW": 12,
      "MEDIUM": 18,
      "HIGH": 12,
      "CRITICAL": 3
    },
    "last_hour": 2
  },
  "risk_scores": {
    "average": 0.234,
    "median": 0.156,
    "max_last_hour": 0.891
  },
  "performance": {
    "avg_analysis_time_ms": 23.4,
    "transactions_per_minute": 12.8
  }
}
```

### **Estat√≠sticas Gerais**
```http
GET /api/v1/stats
```

**Descri√ß√£o**: Retorna estat√≠sticas consolidadas do sistema

**Resposta de Sucesso** (200):
```json
{
  "detection_stats": {
    "total_analyzed": 1547,
    "suspicious_detected": 23,
    "alerts_generated": 45,
    "suspicious_rate": 0.0149,
    "alert_rate": 0.0291,
    "average_risk_score": 0.234,
    "uptime_hours": 24.5
  },
  "blockchain_stats": {
    "blocks_processed": 156,
    "transactions_processed": 1547,
    "relevant_transactions": 89,
    "errors": 2,
    "start_time": "2025-08-21T12:30:00Z"
  },
  "alert_stats": {
    "total_alerts": 45,
    "pending_alerts": 3,
    "processed_alerts": 42,
    "notifications_sent": 38
  }
}
```

---

## üö® **Gest√£o de Alertas**

### **Listar Alertas**
```http
GET /api/v1/alerts
```

**Par√¢metros de Query** (opcionais):
- `limit`: N√∫mero m√°ximo de alertas (padr√£o: 50)
- `severity`: Filtrar por severidade (LOW/MEDIUM/HIGH/CRITICAL)
- `since`: Data/hora desde quando buscar (ISO 8601)

**Exemplo de Uso**:
```http
GET /api/v1/alerts?limit=10&severity=HIGH&since=2025-08-22T00:00:00Z
```

**Resposta de Sucesso** (200):
```json
{
  "alerts": [
    {
      "id": "alert_001",
      "rule_name": "high_value_transfer",
      "severity": "HIGH",
      "title": "High Value Transfer",
      "description": "Transfer of $477,890.47 exceeds threshold",
      "transaction_hash": "0x1234567890abcdef...",
      "wallet_address": "0x742d35Cc631C0532925a3b8D33C9",
      "risk_score": 0.751,
      "detected_at": "2025-08-22T13:15:30Z",
      "status": "pending",
      "context_data": {
        "transfer_amount_usd": 477890.47,
        "gas_price_gwei": 25.0
      }
    }
  ],
  "total_count": 45,
  "has_more": true,
  "filters_applied": {
    "severity": "HIGH",
    "limit": 10
  }
}
```

---

## ‚öôÔ∏è **Configura√ß√£o de Regras**

### **Listar Regras Ativas**
```http
GET /api/v1/rules
```

**Descri√ß√£o**: Retorna configura√ß√£o atual das regras de detec√ß√£o

**Resposta de Sucesso** (200):
```json
{
  "active_rules": [
    "high_value_transfer",
    "new_wallet_interaction", 
    "suspicious_gas_price"
  ],
  "total_active": 3,
  "configured_rules": [
    {
      "name": "high_value_transfer",
      "enabled": true,
      "threshold_usd": 10000,
      "severity": "HIGH",
      "description": "Transfer√™ncia de alto valor detectada",
      "implementation_status": "implemented"
    },
    {
      "name": "wash_trading_pattern",
      "enabled": false,
      "severity": "HIGH", 
      "description": "Padr√£o de wash trading detectado",
      "implementation_status": "pending"
    }
  ],
  "total_configured": 8,
  "implementation_status": {
    "implemented": 3,
    "pending": 5
  }
}
```

### **Recarregar Regras**
```http
POST /api/v1/rules/reload
```

**Descri√ß√£o**: Recarrega configura√ß√£o de regras do arquivo rules.json

**Resposta de Sucesso** (200):
```json
{
  "status": "success",
  "message": "Rules reloaded successfully",
  "rules_loaded": 8,
  "active_rules": 3,
  "timestamp": "2025-08-22T13:15:30Z"
}
```

---

## üîÑ **Controle de Monitoramento**

### **Iniciar Monitoramento**
```http
POST /api/v1/monitoring/start
```

**Descri√ß√£o**: Inicia monitoramento autom√°tico da blockchain

**Resposta de Sucesso** (200):
```json
{
  "status": "started",
  "message": "Blockchain monitoring started",
  "monitoring_active": true,
  "start_time": "2025-08-22T13:15:30Z"
}
```

### **Parar Monitoramento**
```http
POST /api/v1/monitoring/stop
```

**Descri√ß√£o**: Para monitoramento autom√°tico da blockchain

**Resposta de Sucesso** (200):
```json
{
  "status": "stopped", 
  "message": "Blockchain monitoring stopped",
  "monitoring_active": false,
  "stop_time": "2025-08-22T13:15:30Z",
  "session_stats": {
    "duration_minutes": 45.2,
    "transactions_processed": 89,
    "alerts_generated": 3
  }
}
```

---

## üõ†Ô∏è **C√≥digos de Status HTTP**

| C√≥digo | Descri√ß√£o | Uso |
|--------|-----------|-----|
| **200** | OK | Requisi√ß√£o bem-sucedida |
| **400** | Bad Request | Dados inv√°lidos ou campos obrigat√≥rios ausentes |
| **404** | Not Found | Endpoint n√£o encontrado |
| **405** | Method Not Allowed | M√©todo HTTP n√£o permitido |
| **500** | Internal Server Error | Erro interno do servidor |
| **503** | Service Unavailable | Sistema n√£o inicializado |

---

## üìà **Fluxo de An√°lise de Risco**

### **Processo de An√°lise**

1. **Recep√ß√£o**: API recebe dados da transa√ß√£o
2. **Valida√ß√£o**: Verifica campos obrigat√≥rios e formatos
3. **Convers√£o**: ETH ‚Üí USD usando pre√ßo em tempo real
4. **Regras**: Avalia contra regras configuradas
5. **Scoring**: Calcula pontua√ß√£o de risco (0.0-1.0)
6. **Alertas**: Gera alertas baseados em severidade
7. **Resposta**: Retorna resultado completo

### **Fatores de Risco Analisados**

- üí∞ **Valor da Transa√ß√£o**: Compara√ß√£o com thresholds configurados
- ‚õΩ **Gas Price**: Detec√ß√£o de pre√ßos an√¥malos 
- üïê **Timing**: Hor√°rios suspeitos (madrugada, finais de semana)
- üë§ **Idade da Carteira**: Wallets muito novas
- üîÑ **Padr√µes**: Wash trading, estrutura√ß√£o, mixing
- üåê **Rede**: Intera√ß√£o com endere√ßos conhecidos

### **N√≠veis de Risco**

| N√≠vel | Score Range | Cor | A√ß√£o |
|-------|-------------|-----|------|
| **LOW** | 0.0 - 0.3 | üü¢ | Log apenas |
| **MEDIUM** | 0.3 - 0.6 | üü° | Review manual |
| **HIGH** | 0.6 - 0.8 | üî¥ | Alerta imediato |
| **CRITICAL** | 0.8 - 1.0 | üü£ | Bloqueio autom√°tico |

---

## üöÄ **Exemplos de Uso**

### **An√°lise de Transa√ß√£o Simples**

```bash
curl -X POST http://localhost:5000/api/v1/analyze/transaction \
  -H "Content-Type: application/json" \
  -d '{
    "hash": "0xabc123...",
    "from_address": "0x742d35...",
    "value": 50000,
    "gas_price": 25.0,
    "timestamp": "2025-08-22T13:15:30Z",
    "block_number": 23197704
  }'
```

### **Monitoramento em Tempo Real**

```javascript
// JavaScript para dashboard
setInterval(async () => {
    const response = await fetch('/api/v1/metrics/realtime');
    const metrics = await response.json();
    updateDashboard(metrics);
}, 3000); // Atualiza a cada 3 segundos
```

### **Filtragem de Alertas Cr√≠ticos**

```bash
curl "http://localhost:5000/api/v1/alerts?severity=CRITICAL&limit=5"
```

---

## üîß **Configura√ß√£o e Deploy**

### **Vari√°veis de Ambiente**

```bash
# Blockchain APIs
INFURA_URL=https://mainnet.infura.io/v3/YOUR_PROJECT_ID
ETHERSCAN_API_KEY=YOUR_ETHERSCAN_API_KEY

# Database
DATABASE_URL=postgresql://user:pass@localhost/fraud_detection

# Cache
REDIS_URL=redis://localhost:6379/0

# Sistema
DEBUG=False
LOG_LEVEL=INFO
API_RATE_LIMIT=1000
```

### **Inicializa√ß√£o**

```bash
# Instalar depend√™ncias
pip install -r requirements.txt

# Configurar ambiente
cp .env.example .env
# Editar .env com suas configura√ß√µes

# Iniciar sistema
python start.py
```

### **Docker (Futuro)**

```yaml
# docker-compose.yml
version: '3.8'
services:
  fraud-api:
    build: .
    ports:
      - "5000:5000"
    environment:
      - DATABASE_URL=postgresql://postgres:password@db/fraud_detection
    depends_on:
      - db
      - redis
```

---

## üìä **Monitoramento e Observabilidade**

### **Logs Estruturados**

```json
{
  "timestamp": "2025-08-22T13:15:30.123456Z",
  "level": "INFO",
  "service": "fraud_detector",
  "transaction_hash": "0xabc123...",
  "risk_score": 0.751,
  "triggered_rules": ["high_value_transfer"],
  "analysis_duration_ms": 45.2
}
```

### **M√©tricas de Performance**

- ‚ö° **Lat√™ncia**: Tempo m√©dio de an√°lise < 50ms
- üîÑ **Throughput**: 50+ transa√ß√µes/minuto
- üìà **Uptime**: 99.9% disponibilidade
- üéØ **Precis√£o**: Taxa de falsos positivos < 5%

---

## üîí **Seguran√ßa e Compliance**

### **Medidas Implementadas**

- ‚úÖ **Valida√ß√£o de Input**: Sanitiza√ß√£o de todos os dados
- ‚úÖ **Rate Limiting**: Prote√ß√£o contra abuso
- ‚úÖ **Error Handling**: N√£o exposi√ß√£o de dados sens√≠veis
- ‚úÖ **Logging**: Auditoria completa de transa√ß√µes

### **Pr√≥ximos Passos**

- üîê **Autentica√ß√£o JWT**: Para ambiente de produ√ß√£o
- üîí **HTTPS**: Comunica√ß√£o segura
- üõ°Ô∏è **WAF**: Web Application Firewall
- üìã **Compliance**: LGPD/GDPR ready

---

## ü§ù **Suporte e Desenvolvimento**

### **Contato**
- **Equipe**: ChimeraScan Team
- **Vers√£o**: 1.0.0
- **Documenta√ß√£o**: Este arquivo
- **Status**: Produ√ß√£o Ready üöÄ

### **Roadmap**

- [ ] **v1.1**: Machine Learning avan√ßado
- [ ] **v1.2**: Multi-blockchain support 
- [ ] **v1.3**: GraphQL API
- [ ] **v2.0**: Real-time streaming

---

## üìù **Changelog**

### **v1.0.0** (2025-08-22)
- ‚úÖ API REST completa
- ‚úÖ Dashboard interativo  
- ‚úÖ Convers√£o ETH/USD autom√°tica
- ‚úÖ Sistema de regras configur√°vel
- ‚úÖ Alertas em tempo real
- ‚úÖ Integra√ß√£o blockchain Ethereum

---

**üéâ A ChimeraScan API est√° pronta para detectar fraudes e proteger seus ativos tokenizados!**
